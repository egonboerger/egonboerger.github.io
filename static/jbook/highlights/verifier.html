<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML><HEAD>
 <TITLE>Some legal Java programs are not bytecode verifiable</TITLE>
 <link rel=stylesheet type="text/css" href="../website.css">
</HEAD>
<BODY BGCOLOR="#ffffff">

<hr WIDTH="100%">
<i>Java and the Java Virtual Machine
  (<A HREF="http://www.inf.ethz.ch/personal/staerk/">R. St&auml;rk</A>,
   <A HREF="http://www.tydo.de">J. Schmid</A>,
   <A HREF="../../index.html">E. B&ouml;rger</A>)
</i>
<hr WIDTH="100%">

<H1>
Some legal Java programs are not bytecode verifiable
</H1>

There are Java programs which are not accepted by most of the well known
verifiers. The Jbook explains why the following two valid Java programs are
and as a matter of fact should be rejected by most known verifiers. Jbook
restricts the class of valid Java programs in such a way that all programs
can indeed be verified.<p>

The examples programs below  which are rejected by most 
bytecode verifiers (including JDK 1.2, JDK 1.3, 
Netscape 4.73-4.77, Microsoft VM for Java 5.0 and 5.5,
and the <a href="http://www.cs.cornell.edu/People/egs/kimera/verifier.html">Kimera Verifier</a>)
are accepted by 
<a href="http://www.inria.fr/oasis/Bernard.Serpette/">Bernard 
Serpette</a>'s bytecode verifier.
Serpette's bytecode verifier assigns more than one
type frame to an instruction. It 
verifies a subroutine several times, once for each call
of the subroutine.<p>

Sun's J2SE 1.4.2 compiler inlines the code of the finally block
and does not use <tt>jsr/ret</tt>. Therefore, the examples
in Figures 16.8 and 16.9 are accepted by the bytecode verifier
when compiled under 1.4.2.<p>

Figure 16.8 in the Jbook shows the following valid Java program:
<table WIDTH="100%"><tr><td BGCOLOR="#FFFFE0" class="xpmcode">
<pre>
public class Figure16_8 {

  public Figure16_8() { m(false); }

  static int m(boolean b) {
   int i;
   try {
    if (b) return 1;
    i = 2;
   } finally { if (b) i = 3; }
   return i;
  }
}
</pre></td></tr></table>
This Java program cannot be verified by most known verifiers. In the
following lines you can see whether your browser accepts or rejects the
bytecode of the above Java program. If there is no output below, check
whether Java is enabled in your browser.<br><br>
<applet code="http://pages.di.unipi.it/borger/jbook/highlights/LoaderButton" codebase="." alt="Figure 16.8" width="100%" height=120>
       <param name=load     value="Figure16_8">
       <param name=failure  value="Expected: Verify Error.">
       <param name=success1 value="Congratulation, class verified.">
       <param name=success2 value="Please send mail to staerk@inf.ethz.ch">
</applet><br><br>

Figure 16.9 in the Jbook shows the following valid Java program:
<table WIDTH="100%"><tr><td BGCOLOR="#FFFFE0" class="xpmcode">
<pre>
public class Figure16_9 {

  public Figure16_9() { m(true); }
    
  static int m(boolean b) {
   int i;
   L: { try {
         if (b) return 1;
         i = 2;
         if (b) break L;
        } finally { if (b) i = 3; }
        i = 4;
      }
   return i;
  }
}
</pre></td></tr></table>
This Java program cannot be verified by most known verifiers. In the
following lines you can see whether your browser accepts or rejects the
bytecode of the above Java program. If there is no output below, check
whether Java is enabled in your browser.<br><br>
<applet code="http://pages.di.unipi.it/borger/jbook/highlights/LoaderButton" codebase="." alt="Figure 16.9" width="100%" height=120>
       <param name=load     value="Figure16_9">
       <param name=failure  value="Expected: Verify Error.">
       <param name=success1 value="Congratulation, class verified.">
       <param name=success2 value="Please send mail to staerk@inf.ethz.ch">
</applet><br><br>


<A HREF="../index.html">Home</A><br><br>
<HR width="100%">
<table width="100%" cellpadding=0><tbody>
<tr>
  <td align=left valign=top>
  <a href="http://www.ethz.ch/homepage_en.html">ETH Home</A>
  </td>
  <td align=center>March 2001<br>
    <a href="../responsible.html">Responsible</A>
   </td>
  <td align=right>
    <img src="../ethlogo-140.gif" alt="ETH Logo"><br>
  </td>
</tr>
</tbody></table>
</BODY></HTML>
